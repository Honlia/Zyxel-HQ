<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8" />
    <title>新建报备项目</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- csrf token -->
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <!-- csrf header default header name is X-CSRF-TOKEN -->
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    
    <meta http-equiv="pragma" content="no-cache" />  
    <meta http-equiv="cache-control" content="no-cache, must-revalidate" />  
    <meta http-equiv="expires" content="0" />
     
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="media/css/bootstrap.min.css" th:href="@{/media/css/bootstrap.min.css}" rel="stylesheet" type="text/css"/>
    <link href="media/css/bootstrap-responsive.min.css" th:href="@{/media/css/bootstrap-responsive.min.css}" rel="stylesheet" type="text/css"/>
    <link href="media/css/font-awesome.min.css" th:href="@{/media/css/font-awesome.min.css}" rel="stylesheet" type="text/css"/>
    <link href="media/css/style-metro.css" th:href="@{/media/css/style-metro.css}" rel="stylesheet" type="text/css"/>
    <link href="media/css/style.css" th:href="@{/media/css/style.css}" rel="stylesheet" type="text/css"/>
    <link href="media/css/style-responsive.css" th:href="@{/media/css/style-responsive.css}" rel="stylesheet" type="text/css"/>
    <link href="media/css/default.css" th:href="@{/media/css/default.css}" rel="stylesheet" type="text/css" id="style_color"/>
    <link href="media/css/uniform.default.css" th:href="@{/media/css/uniform.default.css}" rel="stylesheet" type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <link rel="shortcut icon" href="media/image/favicon.ico" th:href="@{/media/image/favicon.ico}" />
    
    <style>
        .table th, .table td { 
            text-align: center; 
        }
        .table-scrollable {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            border: 1px solid #dddddd;
            margin: 10px 0 !important;
        }
        #project_form label.error {
            /*margin-left: 185px;*/
            width: auto;
            color: red;
            /*display: inline;*/
        }
        .modal.fade.in{
            top: 60%;
        }
        #overlay {
            background: #000;
            filter: alpha(opacity=50); /* IE的透明度 */
            opacity: 0.5;  /* 透明度 */
            display: none;
            position: absolute;
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
            z-index: 100; /* 此处的图层要大于页面 */
            display:none;
        } 
    </style>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed">
    <!-- BEGIN HEADER -->
    <div th:replace="00_header :: page-header-top"></div>
    <!-- END HEADER -->
    <!-- BEGIN CONTAINER -->   
    <div class="page-container row-fluid">
        <!-- BEGIN SIDEBAR -->
        <div th:replace="00_sidebar :: page-sidebar"></div>
        <!-- END SIDEBAR -->
        <!-- BEGIN PAGE -->
        <div class="page-content">
            <!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <div id="portlet-config" class="modal hide">
                <div class="modal-header">
                    <button data-dismiss="modal" class="close" type="button"></button>
                    <h3>portlet Settings</h3>
                </div>
                <div class="modal-body">
                    <p>Here will be a configuration form</p>
                </div>
            </div>
            <!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <!-- BEGIN PAGE CONTAINER-->
            <div class="container-fluid">
                <!-- BEGIN PAGE HEADER-->
                <div class="row-fluid">
                    <div class="span12">
                        <!-- BEGIN PAGE TITLE & BREADCRUMB-->
                        <h3 class="page-title">
                            新建报备项目 <small></small>
                        </h3>
                        <!-- <ul class="breadcrumb">
                            <li>
                                <i class="icon-home"></i>
                                <a href="05_task.html">首页</a> 
                                <i class="icon-angle-right"></i>
                            </li>
                            <li>
                                <a href="#">项目报备管理</a>
                                <i class="icon-angle-right"></i>
                            </li>
                            <li><a href="#">新建报备项目</a></li>
                        </ul> -->
                        <!-- END PAGE TITLE & BREADCRUMB-->
                    </div>
                </div>
                <!-- END PAGE HEADER-->
                <!-- BEGIN PAGE CONTENT-->
                <div class="row-fluid">
                    <div class="span12">
                        <div class="portlet box blue">

                            <div class="portlet-title">

                                <div class="caption"><i class="icon-reorder"></i>申请项目报备</div>

                                <div class="tools">

                                    <a href="javascript:;" class="collapse"></a>

                                </div>

                            </div>

                            <div class="portlet-body form">

                                <!-- BEGIN FORM-->

                                <form id="project_form" action="#" th:action="@{/newReport}" method="post" class="form-horizontal" th:object="${project}">
                                    
                                    <div class="row-fluid">
                                        <div class="control-group span6">
                                            <label class="control-label" for="projectNumber">项目编号(自动)</label>
                                            <div class="controls">
                                                <input type="text" th:field="*{projectNumber}" placeholder="(例)S01-YYYYMMDD-P01" disabled="disabled" class="span12 m-wrap" />
                                            </div>
                                        </div>
                                        <div class="control-group span6">
                                            <label class="control-label" for="projectName">项目名称<font class="required">(必须)</font></label>
                                            <div class="controls">
                                                <input type="text" th:field="*{projectName}" class="span12 m-wrap" />
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row-fluid">
                                        <div class="control-group span6">
                                            <label class="control-label" for="projectPlace">项目地点<font class="required">(必须)</font></label>
                                            <div class="controls">
                                                <input type="text" th:field="*{projectPlace}" class="span12 m-wrap" />
                                            </div>
                                        </div>

                                        <div class="control-group span6">
                                            <label class="control-label" for="cooperativePartner">合作伙伴<font class="required">(必须)</font></label>
                                            <div class="controls">                                          
                                                <select th:field="*{cooperativePartner}" class="span12 m-wrap">
                                                    <option value="">全部</option>
                                                    <option th:each="item:${agentNames}" th:value="${item.key}" th:text="${item.value}"></option>
                                                </select>
                                            </div>
                                            
                                        </div>
                                    </div>
                                    
                                    <div class="row-fluid">
                                        <div class="control-group span6">
                                            <label class="control-label" for="expectedShipmentTime">预计出货时间<font class="required">(必须)</font></label>
                                            <div class="controls">
                                                <div class="input-append date" data-date-format="yyyy-mm-dd">
                                                    <input th:field="*{expectedShipmentTime}" class="dapn12 m-wrap m-ctrl-medium" readonly="readonly" size="16" type="text" value="" />
                                                    <span class="add-on"><i class="icon-remove"></i></span>
                                                    <span class="add-on"><i class="icon-calendar"></i></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="control-group span6">
                                            <label class="control-label" for="dept">所属部门<font class="required">(必须)</font></label>
                                            <div class="controls">                                          
                                                <select th:field="*{dept}" class="span12 m-wrap" th:disabled="${session.uvo.position=='1' or session.uvo.position=='3'}">
                                                    <option value="">全部</option>
                                                    <option th:each="item:${depts}" th:value="${item.key}" th:text="${item.value}">业务一部</option>
                                                </select>
                                                <input type="hidden" th:field="*{dept}" th:if="${session.uvo.position=='1' or session.uvo.position=='3'}"/>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row-fluid">
                                        <div class="span6">
                                            <div class="control-group">
                                                <label class="control-label" for="projectDescription">项目描述<font class="required">(必须)</font></label>
                                                <div class="controls">
                                                    <textarea th:field="*{projectDescription}" class="span12 m-wrap" rows="3"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>                                  
                                    <!-- BEGIN EXAMPLE TABLE PORTLET-->

                                    <div class="row-fluid">
                                        <div class="span12">
                                            <div class="portlet box green">
                                                <div class="portlet-title">
                                                    <div class="caption"><i class="icon-edit"></i>产品明细</div>
                                                    <div class="tools">
                                                        <a href="javascript:;" class="collapse"></a>
                                                    </div>
                                                </div>

                                                <div class="portlet-body">
                                                    <div class="table-scrollable">
                                                    <table class="table table-hover table-bordered" id="sample_editable_1">
                                                        <thead>
                                                            <tr>
                                                                <th>No.</th>
                                                                <th>产品线</th>
                                                                <th>产品类型</th>
                                                                <th>产品型号</th>
                                                                <th>数量</th>
                                                                <th>价格A</th>
                                                                <th>价格B</th>
                                                                <th>出货价格</th>
                                                                <th>需求日期</th>
                                                                <th>预计<br/>成交金额</th>
                                                                <th>
                                                                    <button type="submit" name="addProductDetail" id="sample_editable_1_new" style="width:60px;" class="btn yellow btn-xs m-wrap">添加</button>
                                                                </th>
                                                            </tr>
                                                        </thead>

                                                        <tbody>
                                                            <tr th:each="row,rowStat:*{productDetailList}">
                                                                <td><span class="help-inline no" th:text="${rowStat.index+1}">1</span></td>
                                                                <td>
                                                                    <select th:field="*{productDetailList[__${rowStat.index}__].productLine}" class="m-wrap productLineList" tabindex="1">
                                                                        <option value="">全部</option>
                                                                        <option th:each="item : ${productLineList}" th:value="${item}" th:text="${item}"></option>
                                                                        <option th:remove="all" value="Category 1">产品线 1</option>
                                                                        <option th:remove="all" value="Category 2">产品线 2</option>
                                                                        <option th:remove="all" value="Category 3">产品线 5</option>
                                                                        <option th:remove="all" value="Category 4">产品线 4</option>
                                                                    </select>
                                                                </td>
                                                                
                                                                <td>
                                                                    <select th:field="*{productDetailList[__${rowStat.index}__].productType}" class="m-wrap productTypeList" tabindex="1">
                                                                        <option value="">全部</option>
                                                                        <option th:each="item : ${productTypeList}" th:value="${item}" th:text="${item}"></option>
                                                                        <option th:remove="all" value="Category 1">产品线 1</option>
                                                                        <option th:remove="all" value="Category 2">产品线 2</option>
                                                                        <option th:remove="all" value="Category 3">产品线 5</option>
                                                                        <option th:remove="all" value="Category 4">产品线 4</option>
                                                                    </select>
                                                                </td>

                                                                <td>
                                                                    <select th:field="*{productDetailList[__${rowStat.index}__].productModel}" class="m-wrap productModelList" tabindex="1">
                                                                        <option value="">全部</option>
                                                                        <option th:each="item : ${productModelList}" th:value="${item}" th:text="${item}"></option>
                                                                        <option th:remove="all" value="Category 1">产品型号 1</option>
                                                                        <option th:remove="all" value="Category 2">产品型号 2</option>
                                                                        <option th:remove="all" value="Category 3">产品型号 5</option>
                                                                        <option th:remove="all" value="Category 4">产品型号 4</option>
                                                                    </select>
                                                                </td>

                                                                <td>
                                                                    <input th:field="*{productDetailList[__${rowStat.index}__].number}" type="text" style="width:60px;"  class="span12 m-wrap number" />
                                                                </td>

                                                                <td class="center">
                                                                    <span style="width: 80px;" class="help-inline platformPrice" th:text="*{productDetailList[__${rowStat.index}__].platformPrice}">1100.00</span>
                                                                    <input class="platformPrice" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].platformPrice}" />
                                                                </td>
                                                                
                                                                <td class="center">
                                                                    <span style="width: 80px;" class="help-inline openPrice" th:text="*{productDetailList[__${rowStat.index}__].openPrice}">1232.00</span>
                                                                    <input class="openPrice" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].openPrice}" />
                                                                </td>

                                                                <td style="width: 80px;" class="center">
                                                                    <input th:field="*{productDetailList[__${rowStat.index}__].expectedPrice}" type="text" style="width:100px;" class="span12 m-wrap expectedPrice" readonly="readonly"/>
                                                                </td>

                                                                <td class="center">
                                                                    <div class="input-append date" data-date-format="yyyy-mm-dd">
                                                                        <input th:field="*{productDetailList[__${rowStat.index}__].requirementDate}" class="span8 dapn12 m-wrap m-ctrl-medium requirementDate" readonly="readonly" style="width:100px;" type="text" value="" />
                                                                        <span class="add-on"><i class="icon-remove"></i></span>
                                                                        <span class="add-on"><i class="icon-calendar"></i></span>
                                                                    </div>
                                                                </td>

                                                                <td class="center">
                                                                    <span style="width: 100px;" class="help-inline expectedTotalPrice" th:text="*{productDetailList[__${rowStat.index}__].expectedTotalPrice}"></span>
                                                                    <input class="expectedTotalPrice" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].expectedTotalPrice}" />
                                                                </td>
                                                                <td>
                                                                    <button type="submit" name="removeProductDetail" th:value="${rowStat.index}" id="sample_editable_1_new" style="width:60px;" class="btn red btn-xs m-wrap">删除</button>
                                                                </td>

                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- END EXAMPLE TABLE PORTLET-->

                                    <div class="form-actions">
                                        <div class="pull-right">
                                            <!-- <button type="submit" name="save" class="btn blue">保存</button> -->
                                            <button type="submit" name="apply" class="btn blue">提交报备</button>
                                        </div>
                                    </div>

                                </form>

                                <!-- END FORM-->       

                            </div>
                        </div>
                    </div>
                </div>
                <!-- END PAGE CONTENT-->
            </div>
            <!-- END PAGE CONTAINER--> 
        </div>
        <!-- END PAGE -->    
    </div>
    <div id="overlay"></div>
    <!-- END CONTAINER -->
    <!-- BEGIN FOOTER -->
    <div th:replace="00_footer :: page-footer"></div>
    <!-- END FOOTER -->
    <!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->

    <!-- BEGIN CORE PLUGINS -->
    <script src="media/js/jquery-1.10.1.min.js" th:src="@{/media/js/jquery-1.10.1.min.js}" type="text/javascript"></script>
    <script src="media/js/jquery-migrate-1.2.1.min.js" th:src="@{/media/js/jquery-migrate-1.2.1.min.js}" type="text/javascript"></script>

    <!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
    <script src="media/js/jquery-ui-1.10.1.custom.min.js" th:src="@{/media/js/jquery-ui-1.10.1.custom.min.js}" type="text/javascript"></script>      
    <script src="media/js/bootstrap.min.js" th:src="@{/media/js/bootstrap.min.js}" type="text/javascript"></script>

    <!--[if lt IE 9]>
    <script src="media/js/excanvas.min.js" th:src="@{/media/js/excanvas.min.js}"></script>
    <script src="media/js/respond.min.js" th:src="@{/media/js/respond.min.js}"></script>  
    <![endif]-->   

    <script src="media/js/jquery.slimscroll.min.js" th:src="@{/media/js/jquery.slimscroll.min.js}" type="text/javascript"></script>
    <script src="media/js/jquery.blockui.min.js" th:src="@{/media/js/jquery.blockui.min.js}" type="text/javascript"></script>  
    <script src="media/js/jquery.cookie.min.js" th:src="@{/media/js/jquery.cookie.min.js}" type="text/javascript"></script>
    <script src="media/js/jquery.uniform.min.js" th:src="@{/media/js/jquery.uniform.min.js}" type="text/javascript" ></script>
    <!-- END CORE PLUGINS -->

    <!-- BEGIN PAGE LEVEL PLUGINS -->

    <script type="text/javascript" src="media/js/ckeditor.js" th:src="@{/media/js/ckeditor.js}"></script>  
    <script type="text/javascript" src="media/js/bootstrap-fileupload.js" th:src="@{/media/js/bootstrap-fileupload.js}"></script>
    <script type="text/javascript" src="media/js/chosen.jquery.min.js" th:src="@{/media/js/chosen.jquery.min.js}"></script>
    <script type="text/javascript" src="media/js/select2.min.js" th:src="@{/media/js/select2.min.js}"></script>
    <script type="text/javascript" src="media/js/wysihtml5-0.3.0.js" th:src="@{/media/js/wysihtml5-0.3.0.js}"></script> 
    <script type="text/javascript" src="media/js/bootstrap-wysihtml5.js" th:src="@{/media/js/bootstrap-wysihtml5.js}"></script>
    <script type="text/javascript" src="media/js/jquery.tagsinput.min.js" th:src="@{/media/js/jquery.tagsinput.min.js}"></script>
    <script type="text/javascript" src="media/js/jquery.toggle.buttons.js" th:src="@{/media/js/jquery.toggle.buttons.js}"></script>
    <script type="text/javascript" src="media/js/bootstrap-datepicker.js" th:src="@{/media/js/bootstrap-datepicker.js}"></script>
    <script type="text/javascript" src="media/js/bootstrap-datetimepicker.js" th:src="@{/media/js/bootstrap-datetimepicker.js}"></script>
    <script type="text/javascript" src="media/js/clockface.js" th:src="@{/media/js/clockface.js}"></script>
    <script type="text/javascript" src="media/js/date.js" th:src="@{/media/js/date.js}"></script>
    <script type="text/javascript" src="media/js/daterangepicker.js" th:src="@{/media/js/daterangepicker.js}"></script> 
    <script type="text/javascript" src="media/js/bootstrap-colorpicker.js" th:src="@{/media/js/bootstrap-colorpicker.js}"></script>  
    <script type="text/javascript" src="media/js/bootstrap-timepicker.js" th:src="@{/media/js/bootstrap-timepicker.js}"></script>
    <script type="text/javascript" src="media/js/jquery.inputmask.bundle.min.js" th:src="@{/media/js/jquery.inputmask.bundle.min.js}"></script>   
    <script type="text/javascript" src="media/js/jquery.input-ip-address-control-1.0.min.js" th:src="@{/media/js/jquery.input-ip-address-control-1.0.min.js}"></script>
    <script type="text/javascript" src="media/js/jquery.multi-select.js" th:src="@{/media/js/jquery.multi-select.js}"></script>
    <script type="text/javascript" src="media/js/jquery.validate.min.js" th:src="@{/media/js/jquery.validate.min.js}"></script>
    <script src="media/js/bootstrap-modal.js" th:src="@{/media/js/bootstrap-modal.js}" type="text/javascript" ></script>
    <script src="media/js/bootstrap-modalmanager.js" th:src="@{/media/js/bootstrap-modalmanager.js}" type="text/javascript" ></script>
    <!-- END PAGE LEVEL PLUGINS -->

    <!-- BEGIN PAGE LEVEL SCRIPTS -->
    <script src="media/js/app.js" th:src="@{/media/js/app.js}"></script>
    <script src="media/js/form-components.js" th:src="@{/media/js/form-components.js}"></script>
    <script src="media/js/table-editable.js" th:src="@{/media/js/table-editable.js}"></script>    
    <!-- END PAGE LEVEL SCRIPTS -->

    <script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/
        /* 显示遮罩层 */
        function showOverlay() {
            $("#overlay").height(pageHeight());
            $("#overlay").width(pageWidth());
        
            // fadeTo第一个参数为速度，第二个为透明度
            // 多重方式控制透明度，保证兼容性，但也带来修改麻烦的问题
            $("#overlay").fadeTo(200, 0.5);
        }
        
        /* 隐藏覆盖层 */
        function hideOverlay() {
            $("#overlay").fadeOut(200);
        }
        
        /* 当前页面高度 */
        function pageHeight() {
            return document.body.scrollHeight;
        }
        
        /* 当前页面宽度 */
        function pageWidth() {
            return document.body.scrollWidth;
        }  
    
         $(function() {
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");
            $(document).ajaxSend(function(e, xhr, options) {
                xhr.setRequestHeader(header, token);
            });
        });
    
        function checkDetail() {
            var modalBody = $(".modal-body");
            modalBody.html('');
            $("span.no").each(function(){
                var msg = '';
                var no = $(this).html();
                var nextAll = $(this).parent().nextAll();
                var productLineList = nextAll.find("select.productLineList");
                var productTypeList = nextAll.find("select.productTypeList");
                var productModelList = nextAll.find("select.productModelList");
                var number = nextAll.find("input.number");
                var expectedPrice = nextAll.find("input.expectedPrice");
                var requirementDate = nextAll.find("input.requirementDate");
                
                if (productLineList.val() == null || productLineList.val() == '') {
                    msg = "No." + no + ": " + "产品线必须选择。";
                    modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                }
                if (productTypeList.val() == null || productTypeList.val() == '') {
                    msg = "No." + no + ": " + "产品类型必须选择。";
                    modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                }
                if (productModelList.val() == null || productModelList.val() == '') {
                    msg = "No." + no + ": " + "产品型号必须选择。";
                    modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                }
                if (number.val() == null || number.val().trim() == '' || number.val().trim() == '0') {
                    msg = "No." + no + ": " + "数量必须输入并且不能是零。";
                    modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                }
                if (expectedPrice.val() == null || expectedPrice.val() == '') {
                    msg = "No." + no + ": " + "预计成交价必须输入。";
                    modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                }
                if (requirementDate.val() == null || requirementDate.val() == '') {
                    msg = "No." + no + ": " + "需求日期必须输入。";
                    modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                }
                
                
            });
            if (modalBody.html() != '') {
            	hideOverlay();
                $("#errorModal").modal("show");
                return false;
            }
        }
               
        jQuery(document).ready(function() {
        	
            // initiate layout and plugins
            App.init();
            FormComponents.init();
            
            $('#project_form').submit(function() {
                showOverlay();
                var i = 0;
                $(".error").each(function(){
                    i++;
                });
                if (i > 0) {
                    hideOverlay();
                }
                return true;
            });
            
            var error = /*[[${error}]]*/'';
            if (error != null && error != '' && error != undefined) {
                $("#errMsg").html(error);
                $("#errorModal").modal("show");
            }
            
            
            $(".input-append.date").datetimepicker({
                minView: "month", //选择日期后，不会再跳转去选择时分秒 
                format: "yyyy-mm-dd", //选择日期后，文本框显示的日期格式 
                language: 'zh-CN', //汉化 
                autoclose:true //选择日期后自动关闭 
            });
           
            // 下拉列表联动控制
            var clearCombox = function(combox){
                combox.empty();
                combox.append("<option value=''>全部</option>");
            };
           
            $(".productLineList").change(function(){
                 var productLineList = $(this);
                 var productTypeList = $(this).parent().nextAll().find("select.productTypeList");

                 var data = {};
                 data["productLine"] = productLineList.val();
                 $.ajax({
                     type : "post",
                     contentType : "application/json;charset=utf-8",
                     url : /*[[@{/populateProductTypeList}]]*/,
                     data : JSON.stringify(data),
                     dataType : 'json',
                     timeout : 100000,
                     success : function(data) {
                         console.log("SUCCESS: ", data);
                         clearCombox(productTypeList);
                         for(var i=0;i<data.length;i++){
                             productTypeList.append("<option value='"+data[i]+"'>"+data[i]+"</option>");
                         }
                     },
                     error : function(e) {
                         console.log("ERROR: ", e);
                     },
                     done : function(e) {
                         console.log("DONE");
                     }
                 });
            });
            
            $(".productTypeList").change(function(){
                var productTypeList = $(this);
                var productLineList = $(this).parent().prevAll().find("select.productLineList");
                var productModelList = $(this).parent().nextAll().find("select.productModelList");

                var data = {};
                data["productLine"] = productLineList.val();
                data["productType"] = productTypeList.val();
                $.ajax({
                    type : "post",
                    contentType : "application/json;charset=utf-8",
                    url : /*[[@{/populateProductModelList}]]*/,
                    data : JSON.stringify(data),
                    dataType : 'json',
                    timeout : 100000,
                    success : function(data) {
                        console.log("SUCCESS: ", data);
                        clearCombox(productModelList);
                        for(var i=0;i<data.length;i++){
                            productModelList.append("<option value='"+data[i]+"'>"+data[i]+"</option>");
                        }
                    },
                    error : function(e) {
                        console.log("ERROR: ", e);
                    },
                    done : function(e) {
                        console.log("DONE");
                    }
                });
           });
            
            $(".productModelList").change(function(){
                
                var productModelList = $(this);
                var productLineList = $(this).parent().prevAll().find("select.productLineList");

                 var data = {};
                 data["productLine"] = productLineList.val();
                 data["productModel"] = productModelList.val();
                 
                 $.ajax({
                     type : "post",
                     contentType : "application/json;charset=utf-8",
                     url : /*[[@{/getProduct}]]*/,
                     data : JSON.stringify(data),
                     dataType : 'json',
                     timeout : 100000,
                     success : function(data) {
                         console.log("SUCCESS: ", data);
                         productModelList.parent().nextAll().find("span.openPrice").html(data.openPrice);
                         productModelList.parent().nextAll().find("input.openPrice").val(data.openPrice);
                         
                         productModelList.parent().nextAll().find("span.platformPrice").html(data.platformPrice);
                         productModelList.parent().nextAll().find("input.platformPrice").val(data.platformPrice);
                         
                         productModelList.parent().nextAll().find("input.expectedPrice").val(data.platformPrice);
                         
                     },
                     error : function(e) {
                         console.log("ERROR: ", e);
                     },
                     done : function(e) {
                         console.log("DONE");
                     }
                 });
                 
            });
            
        
            $(".number").change(function(){
                var number = $(this).val()||0;
                var expectedPrice = $(this).parent().nextAll().find("input.expectedPrice").val()||0;
                var expectedTotalPrice = (parseFloat(number) * parseFloat(expectedPrice)).toFixed(2);
                $(this).parent().nextAll().find("span.expectedTotalPrice").html(expectedTotalPrice);
                $(this).parent().nextAll().find("input.expectedTotalPrice").val(expectedTotalPrice);
            });
            $(".expectedPrice").change(function(){
                var number = $(this).parent().prevAll().find("input.number").val()||0;
                var expectedPrice = $(this).val()||0;
                var expectedTotalPrice = (parseFloat(number) * parseFloat(expectedPrice)).toFixed(2);
                $(this).parent().nextAll().find("span.expectedTotalPrice").html(expectedTotalPrice);
                $(this).parent().nextAll().find("input.expectedTotalPrice").val(expectedTotalPrice);
            });
            
            
            $("#project_form").validate({
            	// 自定义错误信息的显示位置
            	errorPlacement: function(error, element) { 
            	    if (element.is(":radio") ) {
            	        error.appendTo (element.parent()); 
            	    } else if (element.is(":checkbox")) {
            	        error.appendTo (element.parent()); 
            	    } else if (element.is("input[name='expectedShipmentTime']")) {
            	        error.appendTo (element.parent()); 
            	    } else {
            	        error.insertAfter(element); 
            	    }
            	    hideOverlay();
            	},
                rules: {
                    projectName: {
                        required: true,
                        maxlength: 40
                    },
                    projectPlace: {
                    	required: true,
                        maxlength: 50
                    },
                    expectedShipmentTime: {
                    	required: true
                    },
                    cooperativePartner:{
                        required: true
                    },
                    dept: {
                    	required: true
                    },
                    projectDescription: {
                    	required: true
                    }
                    
                },
                messages: {
                    projectName: {
                        required: "项目名称必须输入",
                        maxlength: "项目名称最多可以包含{0}个字符"
                    },
                    projectPlace: {
                        required: "项目地点必须输入",
                        maxlength: "项目地点最多可以包含{0}个字符"
                    },
                    expectedShipmentTime: {
                        required: "预计出货时间必须选择"
                    },
                    cooperativePartner:{
                        required: "合作伙伴必须选择"
                    },
                    dept: {
                        required: "所属部门必须选择"
                    },
                    projectDescription : {
                    	required: "项目描述必须输入"
                    }
                }
            });
            
            /* $("button[name='save']").click(function(){
            	return checkDetail();
            }); */
            $("button[name='apply']").click(function(){
                return checkDetail();
            });
            
        });

        /*]]>*/
        </script>
        
    <!-- END JAVASCRIPTS -->
    <div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&amp;times;</button> -->
                    <h4 class="modal-title" id="myModalLabel">提示</h4>
                </div>
                <div class="modal-body">
                    <p id="errMsg" style="color: red;"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
               </div>
           </div>
       </div>
    </div>
</body>
<!-- END BODY -->
</html>