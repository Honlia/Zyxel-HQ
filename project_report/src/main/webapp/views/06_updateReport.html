<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8" />
    <title>报备项目详细/审批</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->    <meta http-equiv="pragma" content="no-cache" />      <meta http-equiv="cache-control" content="no-cache, must-revalidate" />      <meta http-equiv="expires" content="0" />
    
    <!-- csrf token -->
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <!-- csrf header default header name is X-CSRF-TOKEN -->
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>         <!-- BEGIN GLOBAL MANDATORY STYLES -->    <link href="media/css/bootstrap.min.css" th:href="@{/media/css/bootstrap.min.css}" rel="stylesheet" type="text/css"/>    <link href="media/css/bootstrap-modal.css" th:href="@{/media/css/bootstrap-modal.css}" rel="stylesheet" type="text/css"/>    <link href="media/css/bootstrap-responsive.min.css" th:href="@{/media/css/bootstrap-responsive.min.css}" rel="stylesheet" type="text/css"/>    <link href="media/css/font-awesome.min.css" th:href="@{/media/css/font-awesome.min.css}" rel="stylesheet" type="text/css"/>    <link href="media/css/style-metro.css" th:href="@{/media/css/style-metro.css}" rel="stylesheet" type="text/css"/>    <link href="media/css/style.css" th:href="@{/media/css/style.css}" rel="stylesheet" type="text/css"/>
    <link href="media/css/print.css" th:href="@{/media/css/print.css}" rel="stylesheet" type="text/css" media="print"/>    <link href="media/css/style-responsive.css" th:href="@{/media/css/style-responsive.css}" rel="stylesheet" type="text/css"/>    <link href="media/css/default.css" th:href="@{/media/css/default.css}" rel="stylesheet" type="text/css" id="style_color"/>    <link href="media/css/uniform.default.css" th:href="@{/media/css/uniform.default.css}" rel="stylesheet" type="text/css"/>    <!-- END GLOBAL MANDATORY STYLES -->    <link rel="shortcut icon" href="media/image/favicon.ico" th:href="@{/media/image/favicon.ico}"/>        <style>
        .table th, .table td {             text-align: center;         }
        .table-scrollable {
		    width: 100%;
		    overflow-x: auto;
		    overflow-y: hidden;
		    border: 1px solid #dddddd;
		    margin: 10px 0 !important;
		}
		#projectForm label.error {
            /*margin-left: 185px;*/
            width: auto;
            color: red;
            /*display: inline;*/
        }
		#overlay {
		    background: #000;
		    filter: alpha(opacity=50); /* IE的透明度 */
		    opacity: 0.5;  /* 透明度 */
		    display: none;
		    position: absolute;
		    top: 0px;
		    left: 0px;
		    width: 100%;
		    height: 100%;
		    z-index: 100; /* 此处的图层要大于页面 */
		    display:none;
		}
		
		.print {
		    font-family: courier new;
		    font-size: 9px;
		}
		
		.print table{ border-collapse:collapse; }

		.print th {border:1px solid #000;}
		
		.print td { border:1px solid #000;}
    </style>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed">
    <!-- BEGIN HEADER -->
    <div th:replace="00_header :: page-header-top"></div>
    <!-- END HEADER -->
    <!-- BEGIN CONTAINER -->   
    <div class="page-container row-fluid">
        <!-- BEGIN SIDEBAR -->
        <div th:replace="00_sidebar :: page-sidebar"></div>
        <!-- END SIDEBAR -->
        <!-- BEGIN PAGE -->
        <div class="page-content">
            <!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <div id="portlet-config" class="modal hide">
                <div class="modal-header">
                    <button data-dismiss="modal" class="close" type="button"></button>
                    <h3>portlet Settings</h3>
                </div>
                <div class="modal-body">
                    <p>Here will be a configuration form</p>
                </div>
            </div>
            <!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <!-- BEGIN PAGE CONTAINER-->
            <div class="container-fluid">
                <!-- BEGIN PAGE HEADER-->
                <div class="row-fluid">
                    <div class="span12">
                        <!-- BEGIN PAGE TITLE & BREADCRUMB-->
                        <h3 class="page-title">
                            报备项目详细 /审批<small></small>
                        </h3>
                        <!-- <ul class="breadcrumb">
                            <li>
                                <i class="icon-home"></i>
                                <a href="05_task.html">首页</a> 
                                <i class="icon-angle-right"></i>
                            </li>
                            <li>
                                <a href="#">项目报备管理</a>
                                <i class="icon-angle-right"></i>
                            </li>
                            <li><a href="#">报备项目变更</a></li>
                        </ul> -->
                        <!-- END PAGE TITLE & BREADCRUMB-->
                    </div>
                </div>
                <!-- END PAGE HEADER-->
                <!-- BEGIN PAGE CONTENT-->
                <div class="row-fluid">
                    <div class="span12">                        <div class="portlet box blue">                            <div class="portlet-title">                                <div class="caption"><i class="icon-reorder"></i>项目报备信息</div>                                <div class="tools">                                    <a href="javascript:;" class="collapse"></a>                                </div>                            </div>                            <div class="portlet-body form">                                <!-- BEGIN FORM-->                                <form id="projectForm" action="#" th:action="@{/editReport/{businessKey}(businessKey=${businessKey})}" method="post" class="form-horizontal" th:object="${project}">                                    <input type="hidden" th:field="*{id}"/>
                                    <input type="hidden" th:field="*{currentProcess}"/>
                                    <input type="hidden" name="businessKey" th:value="*{id}" />
                                    <input type="hidden" name="instanceId" th:value="${instanceId}" />
                                    <input type="hidden" name="taskId" th:value="${taskId}" />
                                    <input type="hidden" id="taskComment" name="taskComment" value="" />
                                    <input type="hidden" th:field="*{updateCount}" />
                                    <div class="row-fluid">                                        <div class="span6 ">                                            <div class="control-group">                                                <label class="control-label">项目编号:</label>                                                <div class="controls">                                                    <span class="text bold" th:text="*{projectNumber}">PM0000000001</span>
                                                    <input type="hidden" th:field="*{projectNumber}" />
                                                </div>                                            </div>                                        </div>                                        <!--/span-->                                        <div class="span6 ">                                            <div class="control-group">                                                <label class="control-label">项目名称:</label>                                                <div class="controls">                                                    <input type="text" th:field="*{projectName}" th:readonly="*{__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'B2' or status == 'B3' or status == 'C1'))}" class="span12 m-wrap" />                                                </div>                                            </div>                                        </div>                                        <!--/span-->                                    </div>                                    <!--/row-->                                    <div class="row-fluid">                                        <div class="span6 ">                                            <div class="control-group">                                                <label class="control-label" >项目地点:</label>                                                <div class="controls">                                                    <span class="text" th:text="*{projectPlace}">海泰发展大厦</span> 
                                                    <input type="hidden" th:field="*{projectPlace}" />
                                                </div>                                            </div>                                        </div>                                        <!--/span-->                                        <div class="span6 ">                                            <div class="control-group">                                                <label class="control-label" >合作伙伴:</label>
                                                <div class="controls">	                                                <select th:field="*{cooperativePartner}" th:disabled="${!(session.uvo.position == '1' and __*{currentProcess == 'project_report_flow'}__)}" class="span12 m-wrap">
	                                                    <option value="">全部</option>
	                                                    <option th:each="item:${agentNames}" th:value="${item.key}" th:text="${item.value}"></option>
	                                                </select>
	                                                <input th:if="${!(session.uvo.position == '1' and __*{currentProcess == 'project_report_flow'}__)}" type="hidden" th:field="*{cooperativePartner}" />
                                                </div>                                            </div>                                        </div>                                        <!--/span-->                                    </div>                                    <!--/row-->                                            <div class="row-fluid">                                        <div class="span6 ">                                            <div class="control-group">                                                <label class="control-label" >项目申请时间:</label>                                                <div class="controls">                                                    <span class="text" th:text="*{#dates.format(applyTime, 'yyyy/MM/dd')}">2015-01-01</span>
                                                    <input type="hidden" id="applyTime" name="applyTime" th:value="*{#dates.format(applyTime, 'yyyy-MM-dd HH:mm:ss')}" />
                                                </div>                                            </div>                                        </div>                                        <!--/span-->                                        <div class="span6 ">                                            <div class="control-group">                                                <label class="control-label" >预计出货时间:</label>                                                <div class="controls">                                                    <span  th:if="${!(session.uvo.position == '1' and __*{currentProcess == 'project_report_flow'}__)}" class="text" th:text="*{#dates.format(expectedShipmentTime, 'yyyy/MM/dd')}">2015-01-01</span>
                                                    <input th:if="${!(session.uvo.position == '1' and __*{currentProcess == 'project_report_flow'}__)}" type="hidden" th:field="*{expectedShipmentTime}" />
                                                    <div th:if="${session.uvo.position == '1' and __*{currentProcess == 'project_report_flow'}__}" class="input-append date" data-date-format="yyyy-mm-dd">
	                                                    <input th:field="*{expectedShipmentTime}" class="dapn12 m-wrap m-ctrl-medium expectedShipmentTime" readonly="readonly" size="16" type="text" value="" />
	                                                    <span class="add-on"><i class="icon-remove"></i></span>
	                                                    <span class="add-on"><i class="icon-calendar"></i></span>
	                                                </div>                                                </div>                                            </div>                                        </div>                                        <!--/span-->                                    </div>                                    <!--/row-->                                            <div class="row-fluid">                                        <div class="span6 ">                                            <div class="control-group">                                                <label class="control-label" >所属部门:</label>                                                <div class="controls">                                                    <span class="text" th:text="${depts[__*{dept}__]}">业务一部</span>
                                                    <input type="hidden" th:field="*{dept}" />                                                </div>                                            </div>                                        </div>
                                        <div class="span6 ">
                                            <div class="control-group">
                                                <label class="control-label" >状态:</label>
                                                <div class="controls">
                                                    <span th:if="*{status=='B2' and updateCount != 0}" class="text bold" th:text="|${projectStatusNames[__*{status}__]}(修改*{updateCount}次)|">新建</span>
                                                    <span th:if="*{status=='B2' and updateCount == 0}" class="text bold" th:text="${projectStatusNames[__*{status}__]}">新建</span>
                                                    <span th:if="*{status!='B2'}" class="text bold" th:text="${projectStatusNames[__*{status}__]}">新建</span>
                                                    <input type="hidden" th:field="*{status}" />
                                                </div>
                                            </div>
                                        </div>                                    </div>
                                    <div class="row-fluid">
                                        <div class="span6 ">
                                            <div class="control-group">
                                                <label class="control-label" >项目描述:</label>
                                                <div class="controls">
                                                    <span class="text" th:text="*{projectDescription}">项目描述项目描述项目描述项目描述</span>
                                                    <input type="hidden" th:field="*{projectDescription}" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>                                                                        <!-- BEGIN EXAMPLE TABLE PORTLET-->                                    <div class="row-fluid">                                        <div class="span12">                                            <div class="portlet box green">                                                <div class="portlet-title">                                                    <div class="caption"><i class="icon-edit"></i>产品明细</div>                                                    <div class="tools">                                                        <a href="javascript:;" class="collapse"></a>                                                    </div>                                                </div>                                                <div class="portlet-body">
                                                    <div class="alert" th:if="${session.uvo.position == '5'}">
                                                        <strong>提醒!</strong> 红色金额部分申请价格低于营销成本价，需计算GP%.
                                                        <button type="button" id="notifyGPCal" name="notifyGPCal" class="btn red">GP计算通知</button>
                                                        <button type="button" id="notifyHistory" name="notifyHistory" class="btn blue">查询历史批复</button>
                                                    </div>
                                                    <div class="table-scrollable">                                                    <table class="table table-striped table-hover table-bordered" id="sample_editable_1">                                                        <thead>                                                            <tr>                                                                <th>No.</th>                                                                <th>产品线</th>
                                                                <th>产品类型</th>                                                                <th>产品型号</th>                                                                <th>出货数量</th>                                                                <th>价格A</th>                                                                <th th:if="${session.uvo.position == '1' or session.uvo.position == '3' or session.uvo.position == '4' or session.uvo.position == '5'}">价格B</th>                                                                <th>出货价格</th>                                                                <th>出货时间</th>                                                                <th>最快交期</th>                                                                <th>预计<br/>成交金额</th>
                                                                <th th:if="*{!(__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1'))) and (status != 'E4')}">
                                                                    <button type="submit" name="addProductDetail" id="sample_editable_1_new" style="width:60px;" class="btn yellow btn-xs m-wrap">添加</button>
                                                                </th>                                                            </tr>                                                        </thead>                                                        <tbody>                                                            <tr th:each="row,rowStat:*{productDetailList}">                                                                                                                                <td><span class="help-inline no" th:text="${rowStat.index+1}">1</span></td>                                                                                                                            <td>                                                                    <input type="hidden" th:field="*{productDetailList[__${rowStat.index}__].id}" />
                                                                                                                                        <input  th:if="*{__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1'))}" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].productLine}" />                                                                    <span   th:if="*{__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1'))}" class="help-inline" style="width:120px;" th:text="*{productDetailList[__${rowStat.index}__].productLine}">产品线 1</span>
                                                                    <select th:if="*{!(__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1')))}"
                                                                        th:field="*{productDetailList[__${rowStat.index}__].productLine}" class="m-wrap productLineList" tabindex="1">
                                                                        <option value="">全部</option>
                                                                        <option th:each="item : ${productLineList}" th:value="${item}" th:text="${item}"></option>
                                                                        <option th:remove="all" value="Category 1">产品线 1</option>
                                                                        <option th:remove="all" value="Category 2">产品线 2</option>
                                                                        <option th:remove="all" value="Category 3">产品线 5</option>
                                                                        <option th:remove="all" value="Category 4">产品线 4</option>
                                                                    </select>                                                                </td>
                                                                
                                                                <td>
                                                                    <input  th:if="*{__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1'))}" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].productType}" />
                                                                    <span   th:if="*{__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1'))}" class="help-inline" style="width:120px;" th:text="*{productDetailList[__${rowStat.index}__].productType}">产品线 1</span>
                                                                    <select th:if="*{!(__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1')))}"
                                                                        th:field="*{productDetailList[__${rowStat.index}__].productType}" class="m-wrap productTypeList" tabindex="1">
                                                                        <option value="">全部</option>
                                                                        <option th:each="item : ${productTypeList}" th:value="${item}" th:text="${item}"></option>
                                                                        <option th:remove="all" value="Category 1">产品类型 1</option>
                                                                        <option th:remove="all" value="Category 2">产品类型  2</option>
                                                                        <option th:remove="all" value="Category 3">产品类型  5</option>
                                                                        <option th:remove="all" value="Category 4">产品类型  4</option>
                                                                    </select>
                                                                </td>                                                                                                                                <td>                                                                    <input  th:if="*{__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1'))}" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].productModel}" />                                                                    <span   th:if="*{__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1'))}" class="help-inline" style="width:110px;" th:text="*{productDetailList[__${rowStat.index}__].productModel}">产品型号 1</span>
                                                                    <select th:if="*{!(__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1')))}"
                                                                         th:field="*{productDetailList[__${rowStat.index}__].productModel}" class="m-wrap productModelList" tabindex="1">
                                                                        <option value="">全部</option>
                                                                        <option th:each="item : ${productModelList}" th:value="${item}" th:text="${item}"></option>
                                                                        <option th:remove="all" value="Category 1">产品型号 1</option>
                                                                        <option th:remove="all" value="Category 2">产品型号 2</option>
                                                                        <option th:remove="all" value="Category 3">产品型号 5</option>
                                                                        <option th:remove="all" value="Category 4">产品型号 4</option>
                                                                    </select>                                                                </td>                                                                                                                                <td>                                                                    <input th:field="*{productDetailList[__${rowStat.index}__].number}" th:readonly="*{__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1'))}" type="text" style="width:100px;"  class="span12 m-wrap number" />                                                                </td>                                                                                                                                                                                                <td class="center" th:if="${session.uvo.position == '1' or session.uvo.position == '3' or session.uvo.position == '4' or session.uvo.position == '5'}">                                                                    <input class="platformPrice" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].platformPrice}" />
                                                                    <input th:if="${session.uvo.position == '3'}" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].platformPrice}" />
                                                                    <input th:if="${session.uvo.position == '4'}" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].platformPrice}" />
                                                                    <input th:if="${session.uvo.position == '5'}" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].platformPrice}" />
                                                                    <span th:if="${session.uvo.position == '1'}" class="help-inline platformPrice" th:text="*{productDetailList[__${rowStat.index}__].platformPrice}">1100.00</span>
                                                                    <span th:if="${session.uvo.position == '3'}" class="help-inline" th:text="*{productDetailList[__${rowStat.index}__].platformPrice}">1100.00</span>
                                                                    <span th:if="${session.uvo.position == '4'}" class="help-inline" th:text="*{productDetailList[__${rowStat.index}__].platformPrice}">1100.00</span>
                                                                    <span th:if="${session.uvo.position == '5'}" class="help-inline" th:text="*{productDetailList[__${rowStat.index}__].platformPrice}">1100.00</span>                                                                </td>
                                                                
                                                                <td class="center">
                                                                	<input th:if="${session.uvo.position == '22'}" class="platformPrice" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].platformPrice}" />
                                                                    <input class="openPrice" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].openPrice}" />
                                                                    <span class="help-inline openPrice" th:text="*{productDetailList[__${rowStat.index}__].openPrice}">1232.00</span>
                                                                </td>                                                                                                                                <td class="center" th:with="productDetail=*{productDetailList[__${rowStat.index}__]}">                                                                    <input th:if="${session.uvo.position == '1'}" th:readonly="*{status == 'B2' or status == 'D4' or status == 'D5' or status == 'D6'}" th:field="*{productDetailList[__${rowStat.index}__].expectedPrice}" type="text" style="width:100px;" class="span12 m-wrap expectedPrice" />                                                                    <span th:if="${session.uvo.position != '1'}" class="help-inline expectedPrice" 
                                                                        th:classappend="${(session.uvo.position == '3' and productDetail.expectedPrice lt productDetail.businessDeptManagerPrice) or (session.uvo.position == '4' and productDetail.expectedPrice lt productDetail.mdmManagerPrice) or (session.uvo.position == '5' and productDetail.expectedPrice lt productDetail.generalManagerPrice)}?'alert-error bold'" 
                                                                        th:text="*{productDetailList[__${rowStat.index}__].expectedPrice}">1232.00</span>
                                                                    <input th:if="${session.uvo.position != '1'}" th:field="*{productDetailList[__${rowStat.index}__].expectedPrice}" type="hidden" />
                                                                </td>                                                                                                                                <td class="center">                                                                    <input th:if="*{__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1'))}" readonly="readonly" type="text" th:field="*{productDetailList[__${rowStat.index}__].requirementDate}" class="span8 dapn12 m-wrap m-ctrl-medium requirementDate" style="width:100px;"/>                                                                    <div th:if="*{!(__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1')))}" class="input-append date" data-date-format="yyyy-mm-dd">                                                                        <input th:field="*{productDetailList[__${rowStat.index}__].requirementDate}" class="span8 dapn12 m-wrap m-ctrl-medium requirementDate" readonly="readonly" style="width:100px;" type="text" value="" />
                                                                        <span class="add-on"><i class="icon-remove"></i></span>
                                                                        <span class="add-on"><i class="icon-calendar"></i></span>                                                                    </div>                                                                </td>                                                                <td class="center">                                                                    <input th:if="${session.uvo.position != '22'}" type="text" th:field="*{productDetailList[__${rowStat.index}__].fastestDeliveryDate}" class="span8 dapn12 m-wrap m-ctrl-medium" style="width:100px;" readonly="readonly" />                                                                    <div th:if="${session.uvo.position == '22'}" class="input-append date" data-date-format="yyyy-mm-dd">
                                                                        <input th:field="*{productDetailList[__${rowStat.index}__].fastestDeliveryDate}" class="span8 dapn12 m-wrap m-ctrl-medium cal_fastestDeliveryDate" readonly="readonly" style="width:100px;" type="text" value="" />
                                                                        <span class="add-on"><i class="icon-remove"></i></span>
                                                                        <span class="add-on"><i class="icon-calendar"></i></span>
                                                                    </div>
                                                                </td>                                                                <td class="center">                                                                    <span class="help-inline expectedTotalPrice" style="width:100px;" th:text="*{productDetailList[__${rowStat.index}__].expectedTotalPrice}"></span>                                                                    <input class="expectedTotalPrice" type="hidden" th:field="*{productDetailList[__${rowStat.index}__].expectedTotalPrice}" />                                                                </td>
                                                                <td th:if="*{!(__${session.uvo.position != '1'}__ or (__${session.uvo.position == '1'}__ and (status == 'C1'))) and (status != 'E4')}">
                                                                    <button type="submit" name="removeProductDetail" th:value="${rowStat.index}" id="sample_editable_1_new" style="width:60px;" class="btn red btn-xs m-wrap">删除</button>
                                                                </td>                                                            </tr>                                                        </tbody>                                                    </table>                                                    </div>                                                </div>                                            </div>                                        </div>                                    </div>                                    <!-- END EXAMPLE TABLE PORTLET-->
                                    <div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&amp;times;</button> -->
                                                    <h4 class="modal-title" id="myModalLabel">审批意见</h4>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="row-fluid">
                                                        <div class="span12">
                                                            <div class="control-group">
                                                               <textarea rows="3" id="taskCommentArea" name="taskCommentArea" placeholder="请输入理由" style="margin: 0px 0px 10px; width: 520px; height: 60px;"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                                    <button id="submitForm" type="button" class="btn btn-primary" data-dismiss="modal">提交</button>
                                                    
                                               </div>
                                           </div>
                                       </div>
                                    </div>

                                    <div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&amp;times;</button> -->
                                                    <h4 class="modal-title" id="myModalLabel">提示</h4>
                                                </div>
                                                <div class="modal-body errMsg">
                                                    <p id="errMsg" style="color: red;"></p>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                               </div>
                                           </div>
                                       </div>
                                    </div>
                                    <div class="form-actions">                                        <div class="pull-right">
                                        
                                           <input type="hidden" id="event" name="event" value="" />

                                            <!-- 销售担当  Start-->                                            <button th:if="${session.uvo.position == '1' and __*{status == 'B2'}__}" type="submit" name="lostBid" class="btn red">丢标结案</button>
                                            
                                            <button th:if="${session.uvo.position == '1' and __*{status == 'B3'}__}" type="button" name="cancelApply" class="btn blue">取消报备</button>                                            <button th:if="${session.uvo.position == '1' and __*{status == 'A1' or status == 'B3'}__}" type="submit" name="reportApply" class="btn blue">报备申请</button>
                                            <button th:if="${session.uvo.position == '1' and __*{status == 'B2'}__}" type="submit" name="updateApply" class="btn blue">报备信息更新</button>

                                            <!-- 业务部主管  Start-->
                                            <button th:if="${session.uvo.position == '3' and hasTodoTask and __*{currentProcess == 'project_report_flow'}__}" type="submit" name="reportAgree" class="btn blue"><i class="icon-pencil"></i> 报备同意</button>
                                            <button th:if="${session.uvo.position == '3' and hasTodoTask and __*{currentProcess == 'project_report_flow'}__}" type="button" name="reportDisagree" class="btn red">报备驳回</button>
                                            <!-- 业务部主管  End-->
    
                                            <!-- 销售担当  Start-->
                                            <button th:if="${session.uvo.position == '1' and __*{status == 'B2' or status == 'D4' or status == 'D5' or status == 'D6'}__}" type="submit" name="specialApply" class="btn yellow" >询问最快交期</button>
                                            <button th:if="${session.uvo.position == '22' and hasTodoTask and __*{status == 'D1' or status == 'C3'}__ and __*{currentProcess == 'special_stock_flow'}__}" type="submit" name="deliveryDateConfirm" class="btn green">确认库存及交期</button>
                                            <!-- 销售担当  End-->
    
                                            <!-- 运作部库管  Start-->
                                            <button th:if="${session.uvo.position == '1' and hasTodoTask and __*{currentProcess == 'special_stock_flow'}__ and __*{status != 'D4' and status != 'D5' and status != 'D6'}__}" type="submit" name="deliveryDateAgree" class="btn green">同意交期,申请特价</button>
                                            <button th:if="${session.uvo.position == '1' and hasTodoTask and __*{currentProcess == 'special_stock_flow'}__ and __*{status != 'D4' and status != 'D5' and status != 'D6'}__}" type="button" name="deliveryDateDisagree" class="btn red">不同意交期</button>
                                            <!-- 运作部库管  End-->
    
                                            <!-- 业务一、二部主管、MDM主管、总经理  Start-->
                                            <button th:if="${(session.uvo.position == '3' or session.uvo.position == '4' or session.uvo.position == '5') and hasTodoTask and __*{currentProcess == 'special_stock_flow'}__}" type="submit" name="specialAgree" class="btn blue">特价同意</button>
                                            <button th:if="${(session.uvo.position == '3' or session.uvo.position == '4' or session.uvo.position == '5') and hasTodoTask and __*{currentProcess == 'special_stock_flow'}__}" type="button" name="specialDisagree" class="btn red">特价驳回</button>
                                            <!-- 业务一、二部主管、MDM主管、总经理  End-->
    
                                            <!-- 运作部商务  Start-->
                                            <button th:if="${session.uvo.position == '21' and hasTodoTask and __*{status == 'E1'}__ and __*{currentProcess == 'special_stock_flow'}__}" type="submit" name="orderExecute" class="btn green">全部出货结案</button>
                                            <button th:if="${session.uvo.position == '21' and hasTodoTask and __*{status == 'E1'}__ and __*{currentProcess == 'special_stock_flow'}__}" type="button" name="partShipped" class="btn red">部分出货结案</button>
                                            <button th:if="${session.uvo.position == '21' and hasTodoTask and __*{status == 'E1'}__ and __*{currentProcess == 'special_stock_flow'}__}" type="button" name="notShipped" class="btn red">未出货结案</button>
                                            <button th:if="${session.uvo.position == '21' and hasTodoTask and __*{status == 'E1'}__ and __*{currentProcess == 'special_stock_flow'}__}" type="button" name="printOrderExecute" class="btn green">打印执行订单</button>
                                            <!-- <button  type="button" name="printOrderExecute" class="btn green">打印执行订单</button> -->
                                            <!-- 运作部商务  End-->
                                                                                    </div>
                                    </div>                                </form>                                <!-- END FORM-->                                   </div>                        </div>
                    </div>
                </div>                                <div class="row-fluid">                    <div class="span12">                        <div class="portlet box green">                            <div class="portlet-title">                                <div class="caption"><i class="icon-tasks"></i>工作流信息</div>                                <div class="tools">                                    <a href="javascript:;" class="collapse"></a>                                </div>                            </div>                            <div class="portlet-body">                                <div class="accordion-group" th:each="row,rowStat:${processTaskHistoryList}">                                        <div class="accordion-heading">                                                <a href="#collapse_1" th:href="${'#collapse_' + rowStat.index}" data-parent="#accordion1" data-toggle="collapse" class="accordion-toggle collapsed" th:text="${row.title}">                                        2012-11-23 销售 张三 申请项目报备                                        </a>                                            </div>                                    <div class="accordion-body collapse" id="collapse_1" th:id="${'collapse_' + rowStat.index}">                                        <div class="accordion-inner" th:text="${row.commnet}">                                            2012-11-23 销售 张三 申请项目报备                                                </div>                                            </div>                                        </div>                                <div class="accordion-group" th:remove="all">                                        <div class="accordion-heading">                                                <a href="#collapse_2" data-parent="#accordion1" data-toggle="collapse" class="accordion-toggle collapsed">                                                2012-11-23 业务部主管 张三 驳回项目报备申请                                                </a>                                            </div>                                    <div class="accordion-body collapse" id="collapse_2">                                        <div class="accordion-inner">库存不足</div>                                    </div>                                </div>                            </div>                        </div>                    </div>                </div>
                <div class="row-fluid">                    <div class="span12">                        <div class="portlet box blue">                            <div class="portlet-title">                                <div class="caption"><i class="icon-tasks"></i>报备修改日志</div>                                <div class="tools">                                    <a href="javascript:;" class="collapse"></a>                                </div>                            </div>                            <div class="portlet-body">                                <div class="accordion-group" th:each="row,rowStat:${updateLogList}">                                        <div class="accordion-heading">                                                <a href="#log_collapse_1" th:href="${'#log_collapse_' + rowStat.index}" data-parent="#log_accordion1" data-toggle="collapse" class="accordion-toggle collapsed" th:text="${row.title}">                                        </a>                                            </div>                                    <div class="accordion-body collapse" id="log_collapse_1" th:id="${'log_collapse_' + rowStat.index}">                                        <div class="accordion-inner">                                            <pre th:text="${row.content}"></pre>                                              </div>                                            </div>                                        </div>                            </div>                        </div>                    </div>                </div>
                <!-- END PAGE CONTENT-->
            </div>
            <!-- END PAGE CONTAINER--> 
        </div>
        <!-- END PAGE -->    
    </div>
    <div id="overlay"></div>
    <!-- END CONTAINER -->
    <!-- BEGIN FOOTER -->
    <div th:replace="00_footer :: page-footer"></div>
    <!-- END FOOTER -->
    
    <div th:object="${project}">
        <div th:if="${session.uvo.position == '21' and hasTodoTask and __*{status == 'E1'}__ and __*{currentProcess == 'special_stock_flow'}__}"
             class="modal container fade" id="printModal" tabindex="-1" role="dialog" aria-hidden="true">
            <!-- <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">执行订单打印预览</h4>
            </div> -->
            <div class="modal-body">
                <!-- PRINT AREA -->
                <div id="printArea" class="print" style="overflow-x: hidden;overflow-y: auto;">
                    <div>
                        <div>
                            <div>
                                <div>
                                    <h3 style="text-align: center;">执行订单</h3>
                                    <div>
                                        <span>项目报备信息</span>
                                        <table style="width: 100%;">
                                            <tbody>
                                                <tr>
                                                    <th style="text-align: left;border:1px solid #C0C0C0;" width="20%">项目编号：</th><td style="text-align: left;border:1px solid #C0C0C0;" width="30%" th:text="*{projectNumber}"></td>
                                                    <th style="text-align: left;border:1px solid #C0C0C0;" width="20%">项目名称：</th><td style="text-align: left;border:1px solid #C0C0C0;" width="30%" th:text="*{projectName}"></td>
                                                </tr>
                                                <tr>
                                                    <th style="text-align: left;border:1px solid #C0C0C0;" width="20%">合作伙伴：</th><td style="text-align: left;border:1px solid #C0C0C0;" width="30%" th:text="${agent.agentName}"></td>
                                                    <th style="text-align: left;border:1px solid #C0C0C0;" width="20%">联系人：</th><td style="text-align: left;border:1px solid #C0C0C0;" width="30%" th:text="${agent.contactPerson}"></td>
                                                </tr>
                                                <tr>
                                                    <th style="text-align: left;border:1px solid #C0C0C0;" width="20%">联系邮箱：</th><td style="text-align: left;border:1px solid #C0C0C0;" width="30%" th:text="${agent.mailAddress}"></td>
                                                    <th style="text-align: left;border:1px solid #C0C0C0;" width="20%">联系电话：</th><td style="text-align: left;border:1px solid #C0C0C0;" width="30%" th:text="${agent.mobile}"></td>
                                                </tr>
                                                <tr>
                                                    <th style="text-align: left;border:1px solid #C0C0C0;" width="20%">业务部门：</th><td style="text-align: left;border:1px solid #C0C0C0;" width="30%" th:text="${depts[__*{dept}__]}"></td>
                                                    <th style="text-align: left;border:1px solid #C0C0C0;" width="20%">业务员：</th><td style="text-align: left;border:1px solid #C0C0C0;" width="30%" th:text="*{applyUser}"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div>
                                        <p></p>
                                        <span>申请产品明细</span>
                                        <table style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>产品线</th>
                                                    <th>产品型号</th>
                                                    <th>申请数量</th>
                                                    <th>申请特价<br/>(单价)</th>
                                                    <th>总金额</th>
                                                    <th>需求日期</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr th:each="row,rowStat:*{productDetailList}">
                                                    <td width="18%" th:text="*{productDetailList[__${rowStat.index}__].productLine}">交换机</td>
                                                    <td width="18%" th:text="*{productDetailList[__${rowStat.index}__].productModel}">XSG8809-1</td>
                                                    <td width="16%" style="text-align: right;" th:text="*{productDetailList[__${rowStat.index}__].number}">2</td>
                                                    <td width="16%" style="text-align: right;" th:text="*{productDetailList[__${rowStat.index}__].expectedPrice}">2,000</td>
                                                    <td width="16%" style="text-align: right;" th:text="*{productDetailList[__${rowStat.index}__].expectedTotalPrice}">4,000</td>
                                                    <td width="16%" style="text-align: right;" th:text="*{#dates.format(productDetailList[__${rowStat.index}__].requirementDate, 'yyyy/MM/dd')}">2016/1/30</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div>
                                        <p></p>
                                        <span>出货记录(1)</span>
                                        <table style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>产品线</th>
                                                    <th>产品型号</th>
                                                    <th>本次出货数量</th>
                                                    <th>出货日期</th>
                                                    <th>备注</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr th:each="row,rowStat:*{productDetailList}">
                                                    <td width="18%" th:text="*{productDetailList[__${rowStat.index}__].productLine}">交换机</td>
                                                    <td width="18%" th:text="*{productDetailList[__${rowStat.index}__].productModel}">XSG8809-1</td>
                                                    <td width="16%"></td>
                                                    <td width="16%"></td>
                                                    <td width="32%"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div>
                                        <p></p>
                                        <span>出货记录(2)</span>
                                        <table style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>产品线</th>
                                                    <th>产品型号</th>
                                                    <th>本次出货数量</th>
                                                    <th>出货日期</th>
                                                    <th>备注</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr th:each="row,rowStat:*{productDetailList}">
                                                    <td width="18%" th:text="*{productDetailList[__${rowStat.index}__].productLine}">交换机</td>
                                                    <td width="18%" th:text="*{productDetailList[__${rowStat.index}__].productModel}">XSG8809-1</td>
                                                    <td width="16%"></td>
                                                    <td width="16%"></td>
                                                    <td width="32%"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- <div>
                                        <span>出货记录(3)</span>
                                        <table class="table table-bordered table-striped table-hover print-table" style="border:1px solid #000000;">
                                            <thead>
                                                <tr>
                                                    <th>产品线</th>
                                                    <th style="text-align: center;border:1px solid #000000;">产品型号</th>
                                                    <th style="text-align: center;border:1px solid #000000;">本次出货数量</th>
                                                    <th style="text-align: center;border:1px solid #000000;">出货日期</th>
                                                    <th style="text-align: center;border:1px solid #000000;">备注</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr th:each="row,rowStat:*{productDetailList}">
                                                    <td width="18%" style="text-align: center;border:1px solid #000000;" th:text="*{productDetailList[__${rowStat.index}__].productLine}">交换机</td>
                                                    <td width="18%" style="text-align: center;border:1px solid #000000;" th:text="*{productDetailList[__${rowStat.index}__].productModel}">XSG8809-1</td>
                                                    <td width="16%" style="text-align: center;border:1px solid #000000;"></td>
                                                    <td width="16%" style="text-align: center;border:1px solid #000000;"></td>
                                                    <td width="32%" style="text-align: center;border:1px solid #000000;"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div> -->
                                    <div>
                                        <br/>
                                        <h4>运作部主管：<u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button id="printBtn" type="button" class="btn btn-primary" data-dismiss="modal">打印</button>
           </div>
        </div>
    </div>
    
    
    
    
    <!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->    <!-- BEGIN CORE PLUGINS -->    <script src="media/js/jquery-1.10.1.min.js" th:src="@{/media/js/jquery-1.10.1.min.js}" type="text/javascript"></script>    <script src="media/js/jquery-migrate-1.2.1.min.js" th:src="@{/media/js/jquery-migrate-1.2.1.min.js}" type="text/javascript"></script>    <!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->    <script src="media/js/jquery-ui-1.10.1.custom.min.js" th:src="@{/media/js/jquery-ui-1.10.1.custom.min.js}" type="text/javascript"></script>          <script src="media/js/bootstrap.min.js" th:src="@{/media/js/bootstrap.min.js}" type="text/javascript"></script>    <!--[if lt IE 9]>    <script src="media/js/excanvas.min.js" th:src="@{/media/js/excanvas.min.js}"></script>    <script src="media/js/respond.min.js" th:src="@{/media/js/respond.min.js}"></script>      <![endif]-->       <script src="media/js/jquery.slimscroll.min.js" th:src="@{/media/js/jquery.slimscroll.min.js}" type="text/javascript"></script>    <script src="media/js/jquery.blockui.min.js" th:src="@{/media/js/jquery.blockui.min.js}" type="text/javascript"></script>      <script src="media/js/jquery.cookie.min.js" th:src="@{/media/js/jquery.cookie.min.js}" type="text/javascript"></script>    <script src="media/js/jquery.uniform.min.js" th:src="@{/media/js/jquery.uniform.min.js}" type="text/javascript" ></script>    <!-- END CORE PLUGINS -->    <!-- BEGIN PAGE LEVEL PLUGINS -->    <script type="text/javascript" src="media/js/ckeditor.js" th:src="@{/media/js/ckeditor.js}"></script>      <script type="text/javascript" src="media/js/bootstrap-fileupload.js" th:src="@{/media/js/bootstrap-fileupload.js}"></script>    <script type="text/javascript" src="media/js/chosen.jquery.min.js" th:src="@{/media/js/chosen.jquery.min.js}"></script>    <script type="text/javascript" src="media/js/select2.min.js" th:src="@{/media/js/select2.min.js}"></script>    <script type="text/javascript" src="media/js/wysihtml5-0.3.0.js" th:src="@{/media/js/wysihtml5-0.3.0.js}"></script>     <script type="text/javascript" src="media/js/bootstrap-wysihtml5.js" th:src="@{/media/js/bootstrap-wysihtml5.js}"></script>    <script type="text/javascript" src="media/js/jquery.tagsinput.min.js" th:src="@{/media/js/jquery.tagsinput.min.js}"></script>    <script type="text/javascript" src="media/js/jquery.toggle.buttons.js" th:src="@{/media/js/jquery.toggle.buttons.js}"></script>    <script type="text/javascript" src="media/js/bootstrap-datepicker.js" th:src="@{/media/js/bootstrap-datepicker.js}"></script>    <script type="text/javascript" src="media/js/bootstrap-datetimepicker.js" th:src="@{/media/js/bootstrap-datetimepicker.js}"></script>    <script type="text/javascript" src="media/js/clockface.js" th:src="@{/media/js/clockface.js}"></script>    <script type="text/javascript" src="media/js/date.js" th:src="@{/media/js/date.js}"></script>    <script type="text/javascript" src="media/js/daterangepicker.js" th:src="@{/media/js/daterangepicker.js}"></script>     <script type="text/javascript" src="media/js/bootstrap-colorpicker.js" th:src="@{/media/js/bootstrap-colorpicker.js}"></script>      <script type="text/javascript" src="media/js/bootstrap-timepicker.js" th:src="@{/media/js/bootstrap-timepicker.js}"></script>    <script type="text/javascript" src="media/js/jquery.inputmask.bundle.min.js" th:src="@{/media/js/jquery.inputmask.bundle.min.js}"></script>       <script type="text/javascript" src="media/js/jquery.input-ip-address-control-1.0.min.js" th:src="@{/media/js/jquery.input-ip-address-control-1.0.min.js}"></script>    <script type="text/javascript" src="media/js/jquery.multi-select.js" th:src="@{/media/js/jquery.multi-select.js}"></script>       <script src="media/js/bootstrap-modal.js" th:src="@{/media/js/bootstrap-modal.js}" type="text/javascript" ></script>
    <script type="text/javascript" src="media/js/jquery.validate.min.js" th:src="@{/media/js/jquery.validate.min.js}"></script>    <script src="media/js/bootstrap-modalmanager.js" th:src="@{/media/js/bootstrap-modalmanager.js}" type="text/javascript" ></script>
    <script src="media/js/jquery.jqprint-0.3.js" th:src="@{/media/js/jquery.jqprint-0.3.js}" type="text/javascript" ></script>
    <!-- END PAGE LEVEL PLUGINS -->    <!-- BEGIN PAGE LEVEL SCRIPTS -->    <script src="media/js/app.js" th:src="@{/media/js/app.js}"></script>    <script src="media/js/form-components.js" th:src="@{/media/js/form-components.js}"></script>    <script src="media/js/table-editable.js" th:src="@{/media/js/table-editable.js}"></script>        <!-- END PAGE LEVEL SCRIPTS -->    <script type="text/javascript" th:inline="javascript">    /*<![CDATA[*/
               
        /* 显示遮罩层 */
		function showOverlay() {
		    $("#overlay").height(pageHeight());
		    $("#overlay").width(pageWidth());
		
		    // fadeTo第一个参数为速度，第二个为透明度
		    // 多重方式控制透明度，保证兼容性，但也带来修改麻烦的问题
		    $("#overlay").fadeTo(200, 0.5);
		}
		
		/* 隐藏覆盖层 */
		function hideOverlay() {
			$("#overlay").height(1);
            $("#overlay").width(1);
		    $("#overlay").fadeOut(200);
		}
		
		/* 当前页面高度 */
		function pageHeight() {
		    return document.body.scrollHeight;
		}
		
		/* 当前页面宽度 */
		function pageWidth() {
		    return document.body.scrollWidth;
		}  

        $(function() {
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");
            $(document).ajaxSend(function(e, xhr, options) {
                xhr.setRequestHeader(header, token);
            });
        });
    
        jQuery(document).ready(function() {           // initiate layout and plugins           App.init();           FormComponents.init();
           
           $('#projectForm').submit(function() {
        	   showOverlay();
        	   var i = 0;
        	   $(".error").each(function(){
        		   i++;
        	   });
        	   if (i > 0) {
        		   hideOverlay();
        	   }
        	   
               return true;
           });

           var error = /*[[${error}]]*/'';
           if (error != null && error != '' && error != undefined) {
        	   $("#errMsg").html(error);
               $("#errorModal").modal("show");
           }

           // 下拉列表联动控制
           var clearCombox = function(combox){
               combox.empty();
               combox.append("<option value=''>全部</option>");
           };
          
           $(".productLineList").change(function(){
                var productLineList = $(this);
                var productTypeList = $(this).parent().nextAll().find("select.productTypeList");

                var data = {};
                data["productLine"] = productLineList.val();
                $.ajax({
                    type : "post",
                    contentType : "application/json;charset=utf-8",
                    url : /*[[@{/populateProductTypeList}]]*/,
                    data : JSON.stringify(data),
                    dataType : 'json',
                    timeout : 100000,
                    success : function(data) {
                        console.log("SUCCESS: ", data);
                        clearCombox(productTypeList);
                        for(var i=0;i<data.length;i++){
                            productTypeList.append("<option value='"+data[i]+"'>"+data[i]+"</option>");
                        }
                    },
                    error : function(e) {
                        console.log("ERROR: ", e);
                    },
                    done : function(e) {
                        console.log("DONE");
                    }
                });
           });
           
           $(".productTypeList").change(function(){
               var productTypeList = $(this);
               var productLineList = $(this).parent().prevAll().find("select.productLineList");
               var productModelList = $(this).parent().nextAll().find("select.productModelList");

               var data = {};
               data["productLine"] = productLineList.val();
               data["productType"] = productTypeList.val();
               $.ajax({
                   type : "post",
                   contentType : "application/json;charset=utf-8",
                   url : /*[[@{/populateProductModelList}]]*/,
                   data : JSON.stringify(data),
                   dataType : 'json',
                   timeout : 100000,
                   success : function(data) {
                       console.log("SUCCESS: ", data);
                       clearCombox(productModelList);
                       for(var i=0;i<data.length;i++){
                           productModelList.append("<option value='"+data[i]+"'>"+data[i]+"</option>");
                       }
                   },
                   error : function(e) {
                       console.log("ERROR: ", e);
                   },
                   done : function(e) {
                       console.log("DONE");
                   }
               });
          });
           
           $(".productModelList").change(function(){
               
               var productModelList = $(this);
               var productLineList = $(this).parent().prevAll().find("select.productLineList");

                var data = {};
                data["productLine"] = productLineList.val();
                data["productModel"] = productModelList.val();
                
                $.ajax({
                    type : "post",
                    contentType : "application/json;charset=utf-8",
                    url : /*[[@{/getProduct}]]*/,
                    data : JSON.stringify(data),
                    dataType : 'json',
                    timeout : 100000,
                    success : function(data) {
                        console.log("SUCCESS: ", data);
                        productModelList.parent().nextAll().find("span.openPrice").html(data.openPrice);
                        productModelList.parent().nextAll().find("input.openPrice").val(data.openPrice);
                        
                        productModelList.parent().nextAll().find("span.platformPrice").html(data.platformPrice);
                        productModelList.parent().nextAll().find("input.platformPrice").val(data.platformPrice);
                        
                        productModelList.parent().nextAll().find("input.expectedPrice").val(data.platformPrice);
                    },
                    error : function(e) {
                        console.log("ERROR: ", e);
                    },
                    done : function(e) {
                        console.log("DONE");
                    }
                });
                
           });
           
           
           
           $(".input-append.date").datetimepicker({
               minView: "month", //选择日期后，不会再跳转去选择时分秒 
               format: "yyyy-mm-dd", //选择日期后，文本框显示的日期格式 
               language: 'zh-CN', //汉化 
               autoclose:true //选择日期后自动关闭 
           });                      $(".number").change(function(){                var number = $(this).val()||0;                   var expectedPrice = $(this).parent().nextAll().find("input.expectedPrice").val()||0;                   var expectedTotalPrice = (parseFloat(number) * parseFloat(expectedPrice)).toFixed(2);                   $(this).parent().nextAll().find("span.expectedTotalPrice").html(expectedTotalPrice);                   $(this).parent().nextAll().find("input.expectedTotalPrice").val(expectedTotalPrice);            });            $(".expectedPrice").change(function(){                var number = $(this).parent().prevAll().find("input.number").val()||0;                   var expectedPrice = $(this).val()||0;                   var expectedTotalPrice = (parseFloat(number) * parseFloat(expectedPrice)).toFixed(2);                   $(this).parent().nextAll().find("span.expectedTotalPrice").html(expectedTotalPrice);                   $(this).parent().nextAll().find("input.expectedTotalPrice").val(expectedTotalPrice);            });
            
            $(".alert").hide();
            $(".help-inline.expectedPrice").each(function(){
                if ($(this).hasClass("alert-error bold")) {
                	$("#errMsg").html("最快交期必须输入");
                    $(".alert").show();
                }
            });
            
            $("button[name='reportDisagree']").click(function(){
                $("#basicModal").modal("show");
                $("input#event").val($(this).attr("name"));
            });            $("button[name='deliveryDateDisagree']").click(function(){
                $("#basicModal").modal("show");
                $("input#event").val($(this).attr("name"));
            });            $("button[name='specialDisagree']").click(function(){
                $("#basicModal").modal("show");
                $("input#event").val($(this).attr("name"));
            });
            $("button[name='notShipped']").click(function(){
                $("#basicModal").modal("show");
                $("input#event").val($(this).attr("name"));
            });
            $("button[name='partShipped']").click(function(){
                $("#basicModal").modal("show");
                $("input#event").val($(this).attr("name"));
            });

            // 打印执行订单
            $("button[name='printOrderExecute']").click(function(){
                $("#printModal").modal("show");
            });

            $("#submitForm").click(function(){
                $("#taskComment").val($("#taskCommentArea").val());
                var url = $("#projectForm").attr("action") + "?" + $("input#event").val();
                $("#projectForm").attr("action",url);
                $("#projectForm").submit();
            });
            
            $("button[name='deliveryDateConfirm']").click(function(){
                var modalBody = $(".modal-body.errMsg");
                modalBody.html('');
                $("span.no").each(function(){
                    var msg = '';
                    var no = $(this).html();
                    var nextAll = $(this).parent().nextAll();
                    var fastestDeliveryDate = nextAll.find("input.cal_fastestDeliveryDate");
                    
                    if (fastestDeliveryDate.val() == null || fastestDeliveryDate.val() == '') {
                        msg = "No." + no + ": " + "最快交期必须输入。";
                        modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                    }
                });
                if (modalBody.html() != '') {
                    $("#errorModal").modal("show");
                    return false;
                }
            });
            $("button[name='specialApply'],button[name='updateApply'],button[name='reportApply']").click(function(){
            	var modalBody = $(".modal-body.errMsg");
                modalBody.html('');
                $("span.no").each(function(){
                    var msg = '';
                    var no = $(this).html();
                    var nextAll = $(this).parent().nextAll();
                    var productLineList = nextAll.find("select.productLineList");
                    var productTypeList = nextAll.find("select.productTypeList");
                    var productModelList = nextAll.find("select.productModelList");
                    var number = nextAll.find("input.number");
                    var expectedPrice = nextAll.find("input.expectedPrice");
                    var requirementDate = nextAll.find("input.requirementDate");
                    
                    if (productLineList.val() == null || productLineList.val() == '') {
                        msg = "No." + no + ": " + "产品线必须选择。";
                        modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                    }
                    if (productTypeList.val() == null || productTypeList.val() == '') {
                        msg = "No." + no + ": " + "产品类型必须选择。";
                        modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                    }
                    if (productModelList.val() == null || productModelList.val() == '') {
                        msg = "No." + no + ": " + "产品型号必须选择。";
                        modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                    }
                    if (number.val() == null || number.val().trim() == '' || number.val().trim() == '0') {
                        msg = "No." + no + ": " + "数量必须输入并且不能是零。";
                        modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                    }
                    if (expectedPrice.val() == null || expectedPrice.val() == '') {
                        msg = "No." + no + ": " + "预计成交价必须输入。";
                        modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                    }
                    if (requirementDate.val() == null || requirementDate.val() == '') {
                        msg = "No." + no + ": " + "出货时间必须输入。";
                        modalBody.append('<p id="errMsg" style="color: red;">'+msg+'</p>');
                    }
                });
                if (modalBody.html() != '') {
                	hideOverlay();
                    $("#errorModal").modal("show");
                    return false;
                }
            });
            
            $("#notifyGPCal").click(function(){
                var data = {};
                data["instanceId"] = $("input[name='instanceId']").val();
                data["businessKey"] = $("input[name='businessKey']").val();
                $.ajax({
                    type : "post",
                    contentType : "application/json;charset=utf-8",
                    url : /*[[@{/notifyGPCal}]]*/,
                    data : JSON.stringify(data),
                    dataType : 'json',
                    timeout : 100000,
                    success : function(data) {
                        console.log("SUCCESS: ", data);
                        $("#errMsg").html("GP%计算通知完毕！");
                        $("#errorModal").modal("show");
                    },
                    error : function(e) {
                        console.log("ERROR: ", e);
                    },
                    done : function(e) {
                        console.log("DONE");
                    }
                });
            });
            
            $("#notifyHistory").click(function(){
                var data = {};
                data["instanceId"] = $("input[name='instanceId']").val();
                data["businessKey"] = $("input[name='businessKey']").val();
                $.ajax({
                    type : "post",
                    contentType : "application/json;charset=utf-8",
                    url : /*[[@{/notifyHistory}]]*/,
                    data : JSON.stringify(data),
                    dataType : 'json',
                    timeout : 100000,
                    success : function(data) {
                        console.log("SUCCESS: ", data);
                        $("#errMsg").html("查询历史批复通知完毕！");
                        $("#errorModal").modal("show");
                    },
                    error : function(e) {
                        console.log("ERROR: ", e);
                    },
                    done : function(e) {
                        console.log("DONE");
                    }
                });
            });

            $("#projectForm").validate({
                // 自定义错误信息的显示位置
                errorPlacement: function(error, element) { 
                    if (element.is(":radio") ) {
                        error.appendTo (element.parent()); 
                    } else if (element.is(":checkbox")) {
                        error.appendTo (element.parent()); 
                    } else if (element.is("input[name='expectedShipmentTime']")) {
                        error.appendTo (element.parent()); 
                    } else {
                        error.insertAfter(element); 
                    }
                    hideOverlay();
                },
                rules: {
                    projectName: {
                        required: true,
                        maxlength: 40
                    },
                    expectedShipmentTime: {
                        required: true
                    },
                    cooperativePartner:{
                        required: true
                    }
                },
                messages: {
                    projectName: {
                        required: "项目名称必须输入",
                        maxlength: "项目名称最多可以包含{0}个字符"
                    },
                    expectedShipmentTime: {
                        required: "预计出货时间必须选择"
                    },
                    cooperativePartner:{
                        required: "合作伙伴必须选择"
                    }
                }
            });
            
            
            $("#printBtn").click(function(){
                $("#printArea").jqprint();
            });
            
            
        });    /*]]>*/    </script>
    <!-- END JAVASCRIPTS -->
    </body>
<!-- END BODY -->
</html>